# ë¦¬íŒ©í† ë§

- [ë¦¬íŒ©í† ë§](#ë¦¬íŒ©í† ë§)
  - [í‰ì ](#-í‰ì )
    - [í‰ì  ë“±ë¡](#-í‰ì -ë“±ë¡)
    <!-- - -->
  - [ê²Œì‹œê¸€](#-ê²Œì‹œê¸€)
    - [ê²Œì‹œê¸€ ì¢‹ì•„ìš”](#-ê²Œì‹œê¸€-ì¢‹ì•„ìš”)
    - [ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°](#-ê²Œì‹œê¸€-ìƒì„¸ë³´ê¸°)

## í‰ì 

### ğŸ­ í‰ì  ë“±ë¡

<img src="img/capture/í‰ì  ë“±ë¡.png" width=""></img>

'í‰ì  ì‹ ê·œ ë“±ë¡' ê³¼ 'í‰ì  ìˆ˜ì •' ìœ¼ë¡œ APIê°€ ë¶„ë¦¬ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.

ë‘ APIë¥¼ í•©ì³ ê°’ì´ ë“¤ì–´ì˜¤ë©´ ì‹ ê·œì¸ì§€ ìˆ˜ì •ì¸ì§€ íŒë‹¨í•˜ì—¬ ì²˜ë¦¬í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

ê·¸ ì´ìœ ëŠ” ìºì‹œì— ì €ì¥ëœ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ íŒë‹¨í•˜ì—¬ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì´ë¼ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. í”„ë¡ íŠ¸ì—ì„œ íŒë‹¨í•˜ì—¬ APIë¥¼ êµ¬ë¶„í•´ì„œ ë„˜ê²¨ì£¼ë ¤ë©´ í‰ì ì„ ì¡°íšŒí•˜ëŠ” APIë¥¼ í•œë²ˆ ë” ê±°ì³ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

í•œ ì˜í™”ì˜ í‰ì ê³¼ ê´€ë ¨í•´ì„œ 'ì¡°íšŒìš© í‰ì  ì „ì²´ ì •ë³´', 'ì¡°íšŒìš© ê°œì¸ ìœ ì € í‰ì  ì •ë³´', 'DBë“±ë¡ìš© í‰ì  ì…ë ¥ ì •ë³´' ì— ìºì‹œë¥¼ ì´ìš©í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

DBì— ì¦ì€ ì—…ë°ì´íŠ¸ì™€ ë“±ë¡ìš”ì²­ì„ ë³´ë‚´ê¸°ë³´ë‹¤ ìºì‹œì— ëª¨ì•„ì„œ í•œë²ˆì— ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤ê³  íŒë‹¨í•˜ì—¬ ìºì‹œë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤.

ë¦¬íŒ©í† ë§ì„ ì§„í–‰í•œ í‰ì  ë“±ë¡ APIì˜ ë™ì‘ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. í•´ë‹¹ ì˜í™”ì˜ ì¡°íšŒìš© ì „ì²´ í‰ì ì´ ìºì‹œì— ì—†ë‹¤ë©´ ìƒì„±í•©ë‹ˆë‹¤.

2. í•´ë‹¹ ì˜í™”ì˜ ì¡°íšŒìš© ê°œì¸ ìœ ì € í‰ì  ì •ë³´ê°€ ìºì‹œì— ì—†ë‹¤ë©´ ìƒì„±í•©ë‹ˆë‹¤.

3. ì…ë ¥ë°›ì€ ì •ë³´ë¥¼ ë“±ë¡ìš© ìºì‹œì— ì €ì¥í•©ë‹ˆë‹¤.

   - ìºì‹œì— ì´ë¯¸ ë“±ë¡ ì •ë³´ê°€ ìˆë‹¤ë©´ ìˆ˜ì •í•©ë‹ˆë‹¤.

   - ìºì‹œì— ë“±ë¡ëœ ì •ë³´ê°€ ì—†ë‹¤ë©´ ìœ„ì—ì„œ ë§Œë“  ì¡°íšŒìš© ì •ë³´ë¥¼ ì´ìš©í•´ ìƒˆë¡œ ë“±ë¡í•©ë‹ˆë‹¤.

<br>

ì¡°íšŒìš© ì „ì²´ í‰ì ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œ DBì˜ ì •ë³´ì™€ ìºì‹œì˜ ë“±ë¡ìš© ì •ë³´ë¥¼ ì´ìš©í•˜ì—¬ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.

ìºì‹œì˜ ë°ì´í„°ë“¤ì„ ë¨¼ì € ê³„ì‚°í•˜ê³ , DBì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ë•ŒëŠ” NOT IN ì—°ì‚°ì„ í†µí•´ ìºì‹œì—ì„œ ì´ë¯¸ êº¼ë‚¸ ìœ ì €ì˜ ë°ì´í„°ëŠ” ê°€ì ¸ì˜¤ì§€ ì•Šë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

ì¡°íšŒìš© í‰ì ì˜ ê²½ìš° timeoutì„ ì„¤ì •í•˜ì—¬ ë§Œë£Œë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
private void createTotalRatingCache(long movieId) {
  Long[] result = new Long[7];

  Set<String> redisRatingKeys = redisTemplate.keys("ratingAdd::" + String.valueOf(movieId));
  List<Long> memberList = new ArrayList<>();
  redisRatingKeys.forEach(data -> {
    memberList.add(Long.parseLong(data.split("::")[2]));

    List<String> ratingFromRedis = redisTemplate.opsForList().range(data, 0, 5);
    for (int i = 0; i < 6; i++) {
      result[i] += Long.parseLong(ratingFromRedis.get(5 - i));
    }
  });
  result[6] += redisRatingKeys.size();

  List<RatingEntity> dbList = ratingCustomRepository.getRatingNotInList(movieId, memberList);
  dbList.forEach(data -> {
    result[0] += data.getTotal();
    result[1] += data.getSound();
    result[2] += data.getVisual();
    result[3] += data.getDirection();
    result[4] += data.getActing();
    result[5] += data.getStory();
  });
  result[6] += dbList.size();

  String totalKey = "ratingTotal::" + movieId;
  ListOperations listOperations = redisTemplate.opsForList();
  for (int i = 6; i >= 0; i--) {
    listOperations.leftPush(totalKey, String.valueOf(result[i]));
  }
  listOperations.getOperations().expire(totalKey, Duration.ofMinutes(5));
}
```

<br>

ìºì‹œì— ì €ì¥ëœ ë“±ë¡ìš© ì •ë³´ëŠ” ì¼ì • ì£¼ê¸°ë§ˆë‹¤ DBì— ì €ì¥í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

'ratingAdd'ë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì˜í™”idì™€ ìœ ì €idë¥¼ ì–»ê³ , ì €ì¥ëœ í‰ì ì„ í•´ë‹¹ ìœ ì €, í•´ë‹¹ ì˜í™”ì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.

DBì— í‰ì ì´ ì €ì¥ë˜ì–´ ìˆëŠ” ê²½ìš° dirty checkingì„ í†µí•´ ìˆ˜ì •í•´ì£¼ì—ˆê³ , ìƒˆë¡œ ë“±ë¡í•˜ëŠ” ê²½ìš° ì •ë³´ë“¤ì„ Listì— ëª¨ì•„ì„œ saveAllì„ í†µí•´ í•œë²ˆì— ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.

```java
@Transactional
@Scheduled(cron = "0 0/7 * * * ?")
public void deleteRatingCacheFromRedis() {
    log.info("ìºì‹œì—ì„œ í‰ì  ì •ë³´ DBë¡œ ì €ì¥");
    List<RatingEntity> ratingList = new ArrayList<>();
    Set<String> redisRatingKeys = redisTemplate.keys("ratingAdd*");
    redisRatingKeys.forEach(data -> {
        Long movieId = Long.parseLong(data.split("::")[1]);
        Long userId = Long.parseLong(data.split("::")[2]);
        List<String> ratingFromRedis = redisTemplate.opsForList().range(data, 0, 5);
        RatingEntity myRating = ratingRepository.findPersonal(movieId, userId);
        if(myRating == null) {
            RatingEntity newRating = RatingEntity.builder()
                .story(Long.parseLong(ratingFromRedis.get(0).toString()))
                .acting(Long.parseLong(ratingFromRedis.get(1).toString()))
                .direction(Long.parseLong(ratingFromRedis.get(2).toString()))
                .visual(Long.parseLong(ratingFromRedis.get(3).toString()))
                .sound(Long.parseLong(ratingFromRedis.get(4).toString()))
                .total(Long.parseLong(ratingFromRedis.get(5).toString()))
                .movie(movieRepository.findById(movieId).get())
                .member(memberRepository.findById(userId).get())
                .build();
            ratingList.add(newRating);
        }else {
            myRating.changeRating(ratingFromRedis);
        }

        redisTemplate.delete(data);
    });

    ratingRepository.saveAll(ratingList);
}
```

## ê²Œì‹œê¸€

### ğŸ§¡ ê²Œì‹œê¸€ ì¢‹ì•„ìš”

<img src="img/capture/ê²Œì‹œê¸€ ì¢‹ì•„ìš”.png" width=""></img>

'ê²Œì‹œê¸€ ì¢‹ì•„ìš” ë“±ë¡, ì·¨ì†Œ'ì— Redisë¥¼ ë„ì…í•˜ì—¬ ìš”ì²­ì„ 1ì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

ê²Œì‹œê¸€ ì¢‹ì•„ìš”ì™€ ë¶ë§ˆí¬ ê¸°ëŠ¥ì€ ë‹¤ìˆ˜ì˜ ì‚¬ìš©ìê°€ ë™ì‹œì— ë™ì‘í•˜ì—¬ ë°”ë¡œ DBì— insert, updateí•˜ê²Œë  ê²½ìš° ë¶€í•˜ê°€ ìƒê¸¸ê²ƒìœ¼ë¡œ íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

ìœ ì €ì˜ ì¢‹ì•„ìš” ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ì—¬ 1ì°¨ì ìœ¼ë¡œ ìºì‹œì— ì €ì¥í–ˆê³ , 10ë¶„ë§ˆë‹¤ ìºì‹œì— ì €ì¥ëœ ë‚´ìš©ì„ DBë¡œ ì˜®ê¸°ë„ë¡ ë¦¬íŒ©í† ë§ì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

Redisì˜ Set ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•´ 'boardLikeAdd::(ê²Œì‹œê¸€ë²ˆí˜¸)', 'boardLikeDel::(ê²Œì‹œê¸€ë²ˆí˜¸)'ì„ Keyê°’ìœ¼ë¡œ í•˜ê³ , ìœ ì € ì•„ì´ë””ë¥¼ Valueê°’ìœ¼ë¡œ í•˜ì—¬ ì €ì¥í–ˆìŠµë‹ˆë‹¤.

DBë¡œ ë‚´ìš©ì„ ì˜®ê¸¸ ë•Œ setì˜ size()ë¥¼ ì´ìš©í•´ í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì¢‹ì•„ìš” ìˆ˜ë¥¼ ëˆ„ì ì‹œì¼°ê³ , Valueê°’ìœ¼ë¡œ ì €ì¥ë˜ì–´ìˆëŠ” ìœ ì €ì˜ ì •ë³´ì— í•´ë‹¹ ê²Œì‹œê¸€ ë²ˆí˜¸ë¥¼ ì €ì¥í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

ë¶ë§ˆí¬ë„ ì¢‹ì•„ìš” ê¸°ëŠ¥ê³¼ ê°™ì€ ë°©ì‹ì„ ì ìš©í•˜ì—¬ ë¦¬íŒ©í† ë§ì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

<br>

í•´ë‹¹ ìœ ì €ê°€ í•´ë‹¹ ê²Œì‹œê¸€ì„ ì¢‹ì•„ìš” ëˆ„ë¥¸ ìƒíƒœì¸ì§€ í™•ì¸í•˜ëŠ” ë©”ì„œë“œë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°ì™€ ê°™ì€ ëª‡ ê°€ì§€ APIì—ì„œ ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•  ê²ƒìœ¼ë¡œ íŒë‹¨í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

DBì˜ ì •ë³´ì™€ ìºì‹œì˜ ì¢‹ì•„ìš”ë¥¼ ë“±ë¡í•œ ê²½ìš°, ì·¨ì†Œí•œ ê²½ìš°ë¥¼ í†µí•´ ì¢‹ì•„ìš” ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
/**
 * ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì—¬ë¶€ í™•ì¸
 */
private boolean checkLikeStatus(String boardLike, Long userId, Long boardId) {
    String keyAdd = "boardLikeAdd::" + boardId;
    String keyDel = "boardLikeDel::" + boardId;
    SetOperations<String, String> setOperations = redisTemplate.opsForSet();

    if(setOperations.isMember(keyAdd, String.valueOf(userId))) {
        return true;
    }else if(setOperations.isMember(keyDel, String.valueOf(userId))) {
        return false;
    }else if(boardLike != null && boardLike.contains(String.valueOf(boardId))) {
        return true;
    }
    return false;
}
```

<br>

ì¢‹ì•„ìš” ë“±ë¡, ì·¨ì†Œì˜ ê²½ìš°ëŠ” ìœ ì €ê°€ ì‰½ê²Œ, ì—¬ëŸ¬ë²ˆ ëˆ„ë¥¼ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ê³ , ì—¬ëŸ¬ ìœ ì €ì˜ ë™ì‘ìœ¼ë¡œ DBì— ë§ì€ ë¶€ë‹´ì„ ì¤„ ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í•˜ì—¬ ìºì‹œì— ëª¨ì•„ í•œë²ˆì— ì²˜ë¦¬í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
/**
 * ìºì‹œì—ì„œ ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì •ë³´ DBë¡œ ì €ì¥
 */
@Transactional
@Scheduled(cron = "0 0/10 * * * ?")
public void deleteLikeCacheFromRedis() {
    log.info("ìºì‹œì—ì„œ ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì •ë³´ DBë¡œ ì €ì¥");
    Set<String> redisLikeKeys = redisTemplate.keys("boardLikeAdd*");
    Objects.requireNonNull(redisLikeKeys).forEach(data -> {
        Long boardId = Long.parseLong(data.split("::")[1]);
        Long cnt = redisTemplate.opsForSet().size(data);
        Board board = boardRepository.findById(boardId).get();
        board.getBoardInfo().addLikeCnt(cnt);

        Set<String> redisUsers = redisTemplate.opsForSet().members(data);
        redisUsers.stream().forEach(user -> {
            Long userId = Long.parseLong(user);
            Optional<Member> member = memberRepository.findById(userId);
            String s = member.get().getMemberInfo().getLikeBoard() + boardId + ",";
            member.get().getMemberInfo().setLikeBoard(s);
            redisTemplate.opsForSet().remove(data, user);
        });
    });

    redisLikeKeys = redisTemplate.keys("boardLikeDel*");
    Objects.requireNonNull(redisLikeKeys).forEach(data -> {
        Long boardId = Long.parseLong(data.split("::")[1]);
        Long cnt = redisTemplate.opsForSet().size(data);
        Board board = boardRepository.findById(boardId).get();
        board.getBoardInfo().subtractLikeCnt(cnt);

        Set<String> redisUsers = redisTemplate.opsForSet().members(data);
        redisUsers.stream().forEach(user -> {
            Long userId = Long.parseLong(user);
            Optional<Member> member = memberRepository.findById(userId);
            StringBuilder sb = new StringBuilder(member.get().getMemberInfo().getLikeBoard());
            String s = boardId + ",";
            sb.delete(sb.indexOf(s), sb.indexOf(s) + s.length());
            member.get().getMemberInfo().setLikeBoard(sb.toString());
            redisTemplate.opsForSet().remove(data, user);
        });
    });
}
```

<br>

### ğŸ“‘ ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°

<img src="img/capture/ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°.png" width=""></img>

ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°ë¥¼ ìš”ì²­í•˜ë©´ ì¡°íšŒìˆ˜ê°€ ëŠ˜ì–´ë‚˜ë„ë¡ êµ¬í˜„ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.

ì¡°íšŒìˆ˜ ì¦ê°€ë„ ì¢‹ì•„ìš”, ë¶ë§ˆí¬ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë°”ë¡œ DBì— updateí•  ê²½ìš° ë¶€í•˜ê°€ í´ ê²ƒìœ¼ë¡œ íŒë‹¨í•˜ì—¬ Redisë¥¼ ë„ì…í•˜ì—¬ ê´€ë¦¬í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

ì¡°íšŒìˆ˜ëŠ” Redisì˜ String ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì €ì¥í–ˆìŠµë‹ˆë‹¤. 'boardViewCnt::(ê²Œì‹œê¸€ë²ˆí˜¸)'ë¥¼ Keyë¡œ í•˜ê³ , Valueì— DBì— ëˆ„ì ì‹œí‚¬ ì¡°íšŒìˆ˜ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤.

ë¡œê·¸ì¸í•œ ìœ ì €ê°€ í•´ë‹¹ ê²Œì‹œê¸€ì„ ì¢‹ì•„ìš”í•˜ê³ ìˆëŠ”ì§€ ì—¬ë¶€ëŠ” ì¢‹ì•„ìš” ê¸°ëŠ¥ì—ì„œ ë§Œë“¤ì–´ë†“ì€ checkLikeStatus ë©”ì„œë“œë¥¼ ì¬ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

DBì— ì €ì¥ëœ ì¢‹ì•„ìš” ìˆ˜ì™€ ìºì‹œì— ì €ì¥ëœ ì¢‹ì•„ìš” ë“±ë¡, ì·¨ì†Œ ìˆ˜ë¥¼ ê³„ì‚°í•˜ì—¬ í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì¢‹ì•„ìš”ìˆ˜ë¥¼ ë°˜í™˜í•˜ì˜€ìŠµë‹ˆë‹¤.

<br>

projectionê¸°ëŠ¥ì„ ë„ì…í•˜ì—¬ entityë¥¼ ì „ë¶€ ê°€ì ¸ì˜¤ëŠ” ëŒ€ì‹  í•„ìš”í•œ ì†ì„±ë“¤ë§Œ ì¶”ì¶œí•˜ë„ë¡ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.

entityë¥¼ ì „ë¶€ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤ë©´ ì—°ê´€ëœ í…Œì´ë¸”ì˜ ì •ë³´ê¹Œì§€ ê°€ì ¸ì˜¤ê¸°ë•Œë¬¸ì— ì†ë„ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ projectionì„ ë„ì…í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
public BoardForDetailProjectionDto getBoardForDetail(Long boardId) {
  return queryFactory
    .select(Projections.constructor(BoardForDetailProjectionDto.class,
      board.id.as("boardId"),
      board.movie.id.as("movieId"),
      board.title,
      board.content,
      board.dateTime,
      member.profile.nickname.as("writer"),
      boardInfo.viewCnt.coalesce(0L).as("viewCnt"),
      boardComment.id.count().coalesce(0L).as("commentCnt"),
      boardInfo.likeCnt.coalesce(0L).as("likeCnt")
      ))
    .from(board)
    .join(board.member, member)
    .leftJoin(board.boardComments, boardComment)
    .leftJoin(board.boardInfo, boardInfo)
    .where(board.id.eq(boardId))
    .fetchOne();
}
```

<br>

ê²Œì‹œê¸€ ì¡°íšŒìˆ˜ì˜ ê²½ìš° í´ë¦­ í•œë²ˆìœ¼ë¡œ 1ì”© ì¦ê°€ì‹œì¼œì•¼í•˜ê¸° ë•Œë¬¸ì— ì¦ì€ updateìš”ì²­ì„ í•˜ê¸° ë³´ë‹¤ëŠ” ìºì‹œì— ëª¨ì•„ë†“ê³  ì¼ì • ì£¼ê¸°ë§ˆë‹¤ DBì— í•œë²ˆì— updateí•˜ì˜€ìŠµë‹ˆë‹¤.

```java
/**
 * ìºì‹œì—ì„œ ê²Œì‹œê¸€ ì¡°íšŒìˆ˜ ì •ë³´ DBë¡œ ì €ì¥
 */
@Transactional
@Scheduled(cron = "0 0/3 * * * ?")
public void deleteViewCntCacheFromRedis() {
    log.info("ìºì‹œì—ì„œ ê²Œì‹œê¸€ ì¡°íšŒìˆ˜ ì •ë³´ DBë¡œ ì €ì¥");
    Set<String> redisKeys = redisTemplate.keys("boardViewCnt*");
    Objects.requireNonNull(redisKeys).forEach(data -> {
        Long boardId = Long.parseLong(data.split("::")[1]);
        Board board = boardRepository.findById(boardId).get();
        Long viewCnt = board.getBoardInfo().getViewCnt();
        viewCnt += Long.parseLong(redisTemplate.opsForValue().get(data).toString());
        board.getBoardInfo().setViewCnt(viewCnt);
        redisTemplate.delete(data);
    });
}
```
